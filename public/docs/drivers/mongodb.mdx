
---
title: MongoDB Driver
description: Configura√ß√£o e uso do driver MongoDB
---

# MongoDB Driver

Driver para conex√£o com bancos de dados MongoDB, ideal para dados n√£o-relacionais e estruturas flex√≠veis.

## Instala√ß√£o

```bash
npm install mongodb
```

## Configura√ß√£o

```javascript
const { HelperDB } = require('helperdb');

const db = new HelperDB({
  driver: 'mongodb',
  mongodb: {
    url: 'mongodb://localhost:27017',
    database: 'helperdb',
    collection: 'data',
    options: {
      maxPoolSize: 10,
      minPoolSize: 2,
      maxIdleTimeMS: 30000
    }
  }
});

await db.init();
```

## Op√ß√µes de Configura√ß√£o

### Configura√ß√£o B√°sica
```javascript
{
  url: 'mongodb://localhost:27017',
  database: 'helperdb',
  collection: 'data'
}
```

### Configura√ß√£o com Autentica√ß√£o
```javascript
{
  url: 'mongodb://username:password@localhost:27017/helperdb?authSource=admin',
  database: 'helperdb',
  collection: 'data',
  options: {
    authSource: 'admin',
    authMechanism: 'SCRAM-SHA-256'
  }
}
```

### MongoDB Atlas (Cloud)
```javascript
{
  url: 'mongodb+srv://username:password@cluster.mongodb.net/',
  database: 'helperdb',
  collection: 'data',
  options: {
    retryWrites: true,
    w: 'majority',
    readPreference: 'primary'
  }
}
```

### Replica Set
```javascript
{
  url: 'mongodb://host1:27017,host2:27017,host3:27017/helperdb?replicaSet=myReplSet',
  database: 'helperdb',
  collection: 'data',
  options: {
    readPreference: 'secondaryPreferred',
    maxPoolSize: 20,
    minPoolSize: 5,
    w: 'majority',
    wtimeoutMS: 5000
  }
}
```

## Caracter√≠sticas

### ‚úÖ Vantagens
- Schema flex√≠vel e din√¢mico
- Consultas complexas nativas
- Indexa√ß√£o autom√°tica otimizada
- Sharding horizontal
- Agrega√ß√µes poderosas
- Suporte nativo a arrays e objetos

### üöÄ Recursos Especiais
- GridFS para arquivos grandes
- Change streams para eventos em tempo real
- Transa√ß√µes multi-documento
- Geo-consultas
- Text search nativo

## Exemplos de Uso

### Dados Estruturados Complexos
```javascript
await db.set('user:1', {
  name: 'Jo√£o',
  profile: {
    bio: 'Desenvolvedor Full Stack',
    skills: ['JavaScript', 'Python', 'MongoDB'],
    social: {
      github: 'joao-dev',
      linkedin: 'joao-silva'
    }
  },
  posts: [
    { title: 'Primeiro post', date: new Date(), tags: ['tech'] },
    { title: 'Segundo post', date: new Date(), tags: ['mongodb', 'database'] }
  ],
  location: {
    type: 'Point',
    coordinates: [-23.5505, -46.6333] // S√£o Paulo
  }
});
```

### Busca Complexa
```javascript
// Buscar usu√°rios pr√≥ximos a uma localiza√ß√£o
const nearbyUsers = await db.search({
  'location': {
    $near: {
      $geometry: { type: 'Point', coordinates: [-23.5505, -46.6333] },
      $maxDistance: 1000 // 1km
    }
  }
});

// Buscar por tags em posts
const techPosts = await db.search({
  'posts.tags': { $in: ['tech', 'javascript'] }
});
```

### Agrega√ß√µes
```javascript
// Estat√≠sticas avan√ßadas usando pipeline do MongoDB
const userStats = await db.aggregate([
  { $match: { 'profile.skills': { $exists: true } } },
  { $unwind: '$profile.skills' },
  { $group: { 
    _id: '$profile.skills', 
    count: { $sum: 1 },
    users: { $push: '$name' }
  }},
  { $sort: { count: -1 } },
  { $limit: 10 }
]);
```

## Configura√ß√£o de Produ√ß√£o

```javascript
const db = new HelperDB({
  driver: 'mongodb',
  mongodb: {
    url: process.env.MONGODB_URL,
    database: process.env.MONGODB_DATABASE,
    collection: 'data',
    options: {
      maxPoolSize: 50,
      minPoolSize: 5,
      maxIdleTimeMS: 30000,
      serverSelectionTimeoutMS: 5000,
      socketTimeoutMS: 45000,
      family: 4, // Use IPv4
      
      // Configura√ß√µes de produ√ß√£o
      retryWrites: true,
      w: 'majority',
      readPreference: 'primary',
      readConcern: { level: 'majority' },
      
      // SSL/TLS
      ssl: true,
      sslValidate: true
    }
  }
});
```

## √çndices Autom√°ticos

O driver cria automaticamente √≠ndices otimizados:

```javascript
// √çndices criados automaticamente
{
  "_id": 1,           // √çndice padr√£o
  "key": 1,           // Para busca por chave
  "key_1": "text",    // Para text search
  "createdAt": 1,     // Para queries temporais
  "updatedAt": 1      // Para ordena√ß√£o por atualiza√ß√£o
}
```

## Monitoramento

```javascript
// Verificar sa√∫de da conex√£o MongoDB
const health = await db.ping();
console.log(`MongoDB conectado - Lat√™ncia: ${health.latency}ms`);

// Estat√≠sticas espec√≠ficas do MongoDB
const stats = await db.mongoStats();
console.log('Cole√ß√µes:', stats.collections);
console.log('Tamanho do banco:', stats.dataSize);
console.log('√çndices:', stats.indexes);
```

## Casos de Uso Ideais

- Aplica√ß√µes com dados semi-estruturados
- Sistemas de conte√∫do e CMS
- IoT e telemetria
- An√°lise de dados e big data
- Aplica√ß√µes com consultas geo-espaciais
- Sistemas com schema evolutivo
